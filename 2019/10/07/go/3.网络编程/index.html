<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT">










<meta name="description" content="Socket在标准库 net 包下提供了可一直的网络 I/O 接口，其中包含了 Socket Socket 在 TCP/IP 网络分层中并不存在，它是对 TCP/UDP 的封装  TCPAddr 结构体表示服务器 IP 和端口  type TCPAddr struct &amp;#123;    IP IP    Port int    Zone string&amp;#125;  TCPConn 结构体表示连接">
<meta property="og:type" content="article">
<meta property="og:title" content="网络编程基础和框架">
<meta property="og:url" content="https://yangjinheng.github.io/2019/10/07/go/3.网络编程/index.html">
<meta property="og:site_name" content="默默">
<meta property="og:description" content="Socket在标准库 net 包下提供了可一直的网络 I/O 接口，其中包含了 Socket Socket 在 TCP/IP 网络分层中并不存在，它是对 TCP/UDP 的封装  TCPAddr 结构体表示服务器 IP 和端口  type TCPAddr struct &amp;#123;    IP IP    Port int    Zone string&amp;#125;  TCPConn 结构体表示连接">
<meta property="og:locale" content="zh-Hans">
<meta property="og:updated_time" content="2019-10-22T03:57:51.303Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="网络编程基础和框架">
<meta name="twitter:description" content="Socket在标准库 net 包下提供了可一直的网络 I/O 接口，其中包含了 Socket Socket 在 TCP/IP 网络分层中并不存在，它是对 TCP/UDP 的封装  TCPAddr 结构体表示服务器 IP 和端口  type TCPAddr struct &amp;#123;    IP IP    Port int    Zone string&amp;#125;  TCPConn 结构体表示连接">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://yangjinheng.github.io/2019/10/07/go/3.网络编程/">





  <title>网络编程基础和框架 | 默默</title>
  





  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?be46574a10a6c2b7f67e9c32a008cbd5";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">默默</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-前端知识">
          <a href="/categories/web/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-asterisk"></i> <br>
            
            前端知识
          </a>
        </li>
      
        
        <li class="menu-item menu-item-kubernetes">
          <a href="/categories/Kubernetes/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-cog"></i> <br>
            
            Kubernetes
          </a>
        </li>
      
        
        <li class="menu-item menu-item-运维笔记">
          <a href="/categories/运维笔记/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-sitemap"></i> <br>
            
            运维笔记
          </a>
        </li>
      
        
        <li class="menu-item menu-item-python">
          <a href="/categories/Python/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-laptop"></i> <br>
            
            Python
          </a>
        </li>
      
        
        <li class="menu-item menu-item-个人日志">
          <a href="/categories/个人日志/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-github-alt"></i> <br>
            
            个人日志
          </a>
        </li>
      

      
    </ul>
  

  
</nav>


 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://yangjinheng.github.io/2019/10/07/go/3.网络编程/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jin Heng">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="默默">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">网络编程基础和框架</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-10-07T00:00:00+08:00">
                2019-10-07
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/golang/" itemprop="url" rel="index">
                    <span itemprop="name">golang</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h1 id="Socket"><a href="#Socket" class="headerlink" title="Socket"></a>Socket</h1><p>在标准库 net 包下提供了可一直的网络 I/O 接口，其中包含了 Socket</p>
<p>Socket 在 TCP/IP 网络分层中并不存在，它是对 TCP/UDP 的封装</p>
<ol>
<li>TCPAddr 结构体表示服务器 IP 和端口</li>
</ol>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> TCPAddr <span class="keyword">struct</span> &#123;</span><br><span class="line">    IP IP</span><br><span class="line">    Port <span class="keyword">int</span></span><br><span class="line">    Zone <span class="keyword">string</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>TCPConn 结构体表示连接，封装了数据读写操作</li>
</ol>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> TCPConn <span class="keyword">struct</span> &#123;</span><br><span class="line">	conn</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol start="3">
<li>TCPListener 负责监听服务器端特定端口</li>
</ol>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> TCPListener <span class="keyword">struct</span> &#123;</span><br><span class="line">    fd *netFD</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="回显服务器"><a href="#回显服务器" class="headerlink" title="回显服务器"></a>回显服务器</h2><ul>
<li>server</li>
</ul>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	<span class="string">"net"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// 创建 TCPAddress 变量，指向协议 TCP4，监听本机的一个端口</span></span><br><span class="line">	addr, _ := net.ResolveTCPAddr(<span class="string">"tcp4"</span>, <span class="string">"localhost:8000"</span>)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 监听 TCPAddress 设定的地址</span></span><br><span class="line">	lis, _ := net.ListenTCP(<span class="string">"tcp4"</span>, addr)</span><br><span class="line"></span><br><span class="line">	fmt.Println(<span class="string">"服务器已经启动"</span>)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 服务器接收和建立连接是不间断的</span></span><br><span class="line">	<span class="keyword">for</span> &#123;</span><br><span class="line">		<span class="comment">// 阻塞时等待客户端消息，返回连接对象，用于接收客户端消息或向客户端发送消息</span></span><br><span class="line">		conn, _ := lis.Accept()</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 把数据读取到切片中</span></span><br><span class="line">		b := <span class="built_in">make</span>([]<span class="keyword">byte</span>, <span class="number">256</span>)</span><br><span class="line">		fmt.Println(<span class="string">"read之前"</span>)</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 客户端没有发送数据且客户端对象没有关闭，Read() 将会阻塞，一旦接收到数据就不阻塞</span></span><br><span class="line">		count, _ := conn.Read(b)</span><br><span class="line">		fmt.Println(<span class="string">"接收到数据:"</span>, <span class="keyword">string</span>(b[:count]))</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 向客户端返回一个消息</span></span><br><span class="line">		conn.Write([]<span class="keyword">byte</span>(<span class="string">"server"</span> + <span class="keyword">string</span>(b[:count])))</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 关闭连接</span></span><br><span class="line">		conn.Close()</span><br><span class="line">	&#125;</span><br><span class="line">	fmt.Println(<span class="string">"服务器停止运行"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>client</li>
</ul>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	<span class="string">"net"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// 创建服务器端地址</span></span><br><span class="line">	addr, _ := net.ResolveTCPAddr(<span class="string">"tcp4"</span>, <span class="string">"localhost:8000"</span>)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 创建连接</span></span><br><span class="line">	conn, _ := net.DialTCP(<span class="string">"tcp"</span>, <span class="literal">nil</span>, addr)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 发送数据</span></span><br><span class="line">	conn.Write([]<span class="keyword">byte</span>(<span class="string">"客户端发送的数据"</span>))</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 接收数据</span></span><br><span class="line">	b := <span class="built_in">make</span>([]<span class="keyword">byte</span>, <span class="number">256</span>)</span><br><span class="line">	fmt.Println(<span class="string">"read之前"</span>)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 接收数据</span></span><br><span class="line">	count, _ := conn.Read(b)</span><br><span class="line">	fmt.Println(<span class="string">"接收到数据:"</span>, <span class="keyword">string</span>(b[:count]))</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 关闭连接</span></span><br><span class="line">	conn.Close()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="并发回显服务器"><a href="#并发回显服务器" class="headerlink" title="并发回显服务器"></a>并发回显服务器</h2><ul>
<li>server，使用 goroutine 接收处理每个请求</li>
</ul>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// 创建 TCPAddress 变量，指向协议 TCP4，监听本机的一个端口</span></span><br><span class="line">	addr, _ := net.ResolveTCPAddr(<span class="string">"tcp4"</span>, <span class="string">"localhost:8000"</span>)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 监听 TCPAddress 设定的地址</span></span><br><span class="line">	lis, _ := net.ListenTCP(<span class="string">"tcp4"</span>, addr)</span><br><span class="line"></span><br><span class="line">	fmt.Println(<span class="string">"服务器已经启动"</span>)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 服务器接收和建立连接是不间断的</span></span><br><span class="line">	<span class="keyword">for</span> &#123;</span><br><span class="line">		<span class="comment">// 阻塞时等待客户端消息，返回连接对象，用于接收客户端消息或向客户端发送消息</span></span><br><span class="line">		conn, _ := lis.Accept()</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 添加 goroutine 让服务器支持并发</span></span><br><span class="line">		<span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">			<span class="comment">// 把数据读取到切片中</span></span><br><span class="line">			b := <span class="built_in">make</span>([]<span class="keyword">byte</span>, <span class="number">256</span>)</span><br><span class="line">			fmt.Println(<span class="string">"read之前"</span>)</span><br><span class="line"></span><br><span class="line">			<span class="comment">// 有意延迟</span></span><br><span class="line">			time.Sleep(<span class="number">2e9</span>)</span><br><span class="line"></span><br><span class="line">			<span class="comment">// 客户端没有发送数据且客户端对象没有关闭，Read() 将会阻塞，一旦接收到数据就不阻塞</span></span><br><span class="line">			count, _ := conn.Read(b)</span><br><span class="line">			fmt.Println(<span class="string">"接收到数据:"</span>, <span class="keyword">string</span>(b[:count]))</span><br><span class="line"></span><br><span class="line">			<span class="comment">// 向客户端返回一个消息</span></span><br><span class="line">			conn.Write([]<span class="keyword">byte</span>(<span class="string">"server"</span> + <span class="keyword">string</span>(b[:count])))</span><br><span class="line"></span><br><span class="line">			<span class="comment">// 关闭连接</span></span><br><span class="line">			conn.Close()</span><br><span class="line">		&#125;()</span><br><span class="line">	&#125;</span><br><span class="line">	fmt.Println(<span class="string">"服务器停止运行"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>client，使用 go route 模拟同时发送 10 个请求</li>
</ul>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// 创建服务器端地址</span></span><br><span class="line">	addr, _ := net.ResolveTCPAddr(<span class="string">"tcp4"</span>, <span class="string">"localhost:8000"</span>)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">10</span>; i++ &#123;</span><br><span class="line">		<span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">			<span class="comment">// 创建连接</span></span><br><span class="line">			conn, _ := net.DialTCP(<span class="string">"tcp"</span>, <span class="literal">nil</span>, addr)</span><br><span class="line"></span><br><span class="line">			<span class="comment">// 发送数据</span></span><br><span class="line">			conn.Write([]<span class="keyword">byte</span>(<span class="string">"客户端发送的数据"</span>))</span><br><span class="line"></span><br><span class="line">			<span class="comment">// 接收数据</span></span><br><span class="line">			b := <span class="built_in">make</span>([]<span class="keyword">byte</span>, <span class="number">256</span>)</span><br><span class="line"></span><br><span class="line">			<span class="comment">// 接收数据</span></span><br><span class="line">			count, _ := conn.Read(b)</span><br><span class="line">			fmt.Println(<span class="string">"接收到数据:"</span>, <span class="keyword">string</span>(b[:count]))</span><br><span class="line"></span><br><span class="line">			<span class="comment">// 关闭连接</span></span><br><span class="line">			conn.Close()</span><br><span class="line">		&#125;()</span><br><span class="line">	&#125;</span><br><span class="line">	time.Sleep(<span class="number">3e9</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="点对点通信"><a href="#点对点通信" class="headerlink" title="点对点通信"></a>点对点通信</h2><p>点对点通信是一个客户端与客户端的通信</p>
<ul>
<li>server</li>
</ul>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">type</span> User <span class="keyword">struct</span> &#123;</span><br><span class="line">	Username  <span class="keyword">string</span></span><br><span class="line">	OtherUser <span class="keyword">string</span></span><br><span class="line">	Msg       <span class="keyword">string</span></span><br><span class="line">	ServerMsg <span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> (</span><br><span class="line">	usermap = <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">string</span>]net.Conn)</span><br><span class="line">	user    = <span class="built_in">new</span>(User)</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	addr, _ := net.ResolveTCPAddr(<span class="string">"tcp4"</span>, <span class="string">"127.0.0.1:8000"</span>)</span><br><span class="line">	lis, _ := net.ListenTCP(<span class="string">"tcp4"</span>, addr)</span><br><span class="line">	<span class="keyword">for</span> &#123;</span><br><span class="line">		conn, _ := lis.Accept()</span><br><span class="line">		<span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">			<span class="keyword">for</span> &#123;</span><br><span class="line">				b := <span class="built_in">make</span>([]<span class="keyword">byte</span>, <span class="number">1024</span>)</span><br><span class="line">				count, _ := conn.Read(b)</span><br><span class="line">				array := strings.Split(<span class="keyword">string</span>(b[:count]), <span class="string">"-"</span>)</span><br><span class="line">				user.Username = array[<span class="number">0</span>]</span><br><span class="line">				user.OtherUser = array[<span class="number">1</span>]</span><br><span class="line">				user.Msg = array[<span class="number">2</span>]</span><br><span class="line">				user.ServerMsg = array[<span class="number">3</span>]</span><br><span class="line">				usermap[user.Username]=conn</span><br><span class="line">				<span class="keyword">if</span> v, ok := usermap[user.OtherUser]; ok &amp;&amp; v != <span class="literal">nil</span> &#123;</span><br><span class="line">					message := fmt.Sprintf(<span class="string">"%s-%s-%s-%s"</span>, user.Username, user.OtherUser, user.Msg, user.ServerMsg)</span><br><span class="line">					n, err := v.Write([]<span class="keyword">byte</span>(message))</span><br><span class="line">					<span class="keyword">if</span> n &lt;= <span class="number">0</span> || err != <span class="literal">nil</span> &#123;</span><br><span class="line">						<span class="built_in">delete</span>(usermap, user.OtherUser)</span><br><span class="line">						conn.Close()</span><br><span class="line">						v.Close()</span><br><span class="line">						<span class="keyword">break</span></span><br><span class="line">					&#125;</span><br><span class="line">				&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">					user.ServerMsg = <span class="string">"对方不在线"</span></span><br><span class="line">					message := fmt.Sprintf(<span class="string">"%s-%s-%s-%s"</span>, user.Username, user.OtherUser, user.Msg, user.ServerMsg)</span><br><span class="line">					conn.Write([]<span class="keyword">byte</span>(message))</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;()</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>client</li>
</ul>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> User <span class="keyword">struct</span> &#123;</span><br><span class="line">	Username      <span class="keyword">string</span></span><br><span class="line">	OtherUsername <span class="keyword">string</span></span><br><span class="line">	Msg           <span class="keyword">string</span></span><br><span class="line">	ServerMsg     <span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> (</span><br><span class="line">	user = <span class="built_in">new</span>(User)</span><br><span class="line">	wg   sync.WaitGroup</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	wg.Add(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">	fmt.Println(<span class="string">"请输入您的账号:"</span>)</span><br><span class="line">	fmt.Scanln(&amp;user.Username)</span><br><span class="line">	fmt.Println(<span class="string">"请输入要给谁发送消息:"</span>)</span><br><span class="line">	fmt.Scanln(&amp;user.OtherUsername)</span><br><span class="line"></span><br><span class="line">	addr, _ := net.ResolveTCPAddr(<span class="string">"tcp4"</span>, <span class="string">"127.0.0.1:8000"</span>)</span><br><span class="line">	conn, _ := net.DialTCP(<span class="string">"tcp4"</span>, <span class="literal">nil</span>, addr)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">"请输入要发送的信息，本提示仅一次，以后直接输入"</span>)</span><br><span class="line">		<span class="keyword">for</span> &#123;</span><br><span class="line">			fmt.Scanln(&amp;user.Msg)</span><br><span class="line">			<span class="keyword">if</span> user.Msg == <span class="string">"exit"</span> &#123;</span><br><span class="line">				conn.Close()</span><br><span class="line">				wg.Done()</span><br><span class="line">				os.Exit(<span class="number">0</span>)</span><br><span class="line">			&#125;</span><br><span class="line">			message := fmt.Sprintf(<span class="string">"%s-%s-%s-%s"</span>, user.Username, user.OtherUsername, user.Msg, user.ServerMsg)</span><br><span class="line">			conn.Write([]<span class="keyword">byte</span>(message))</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;()</span><br><span class="line"></span><br><span class="line">	<span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">		<span class="keyword">for</span> &#123;</span><br><span class="line">			b := <span class="built_in">make</span>([]<span class="keyword">byte</span>, <span class="number">1024</span>)</span><br><span class="line">			count, _ := conn.Read(b)</span><br><span class="line">			array := strings.Split(<span class="keyword">string</span>(b[:count]), <span class="string">"-"</span>)</span><br><span class="line">			user2 := <span class="built_in">new</span>(User)</span><br><span class="line">			user2.Username = array[<span class="number">0</span>]</span><br><span class="line">			user2.OtherUsername = array[<span class="number">1</span>]</span><br><span class="line">			user2.Msg = array[<span class="number">2</span>]</span><br><span class="line">			user2.ServerMsg = array[<span class="number">3</span>]</span><br><span class="line">			<span class="keyword">if</span> user2.ServerMsg != <span class="string">""</span> &#123;</span><br><span class="line">				fmt.Println(<span class="string">"\t服务器的消息"</span>, user2.ServerMsg)</span><br><span class="line">			&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">				fmt.Println(<span class="string">"\t"</span>, user2.Username, <span class="string">":"</span>, user2.Msg)</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;()</span><br><span class="line">	wg.Wait()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="mysql"><a href="#mysql" class="headerlink" title="mysql"></a>mysql</h1><ul>
<li>驱动包地址</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">https://github.com/go-sql-driver/mysql.git</span><br></pre></td></tr></table></figure>
<h2 id="安装驱动"><a href="#安装驱动" class="headerlink" title="安装驱动"></a>安装驱动</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">go get -u github.com/go-sql-driver/mysql</span><br></pre></td></tr></table></figure>
<h2 id="连接数据库"><a href="#连接数据库" class="headerlink" title="连接数据库"></a>连接数据库</h2><ul>
<li>在 test 数据库新建一个表</li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`people`</span> (</span><br><span class="line">  <span class="string">`id`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  <span class="string">`name`</span> <span class="built_in">varchar</span>(<span class="number">20</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`address`</span> <span class="built_in">varchar</span>(<span class="number">100</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  PRIMARY <span class="keyword">KEY</span> (<span class="string">`id`</span>)</span><br><span class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span> AUTO_INCREMENT=<span class="number">2</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8mb4;</span><br></pre></td></tr></table></figure>
<ul>
<li>连接数据库并测试连接</li>
</ul>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"database/sql"</span></span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line">	_ <span class="string">"github.com/go-sql-driver/mysql"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// 新建驱动连接</span></span><br><span class="line">	db, err := sql.Open(<span class="string">"mysql"</span>, <span class="string">"root:123456@tcp(172.16.100.10:3306)/test"</span>)</span><br><span class="line">	<span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">		<span class="keyword">if</span> db != <span class="literal">nil</span> &#123;</span><br><span class="line">			db.Close()</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;()</span><br><span class="line">    </span><br><span class="line">	<span class="comment">// 测试连接</span></span><br><span class="line">	err = db.Ping()</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">"数据库连接失败"</span>)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="插入数据"><a href="#插入数据" class="headerlink" title="插入数据"></a>插入数据</h2><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"database/sql"</span></span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line">	_ <span class="string">"github.com/go-sql-driver/mysql"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// 新建驱动连接</span></span><br><span class="line">	db, err := sql.Open(<span class="string">"mysql"</span>, <span class="string">"root:123456@tcp(172.16.100.10:3306)/test"</span>)</span><br><span class="line">	<span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">		<span class="keyword">if</span> db != <span class="literal">nil</span> &#123;</span><br><span class="line">			db.Close()</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;()</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 测试连接</span></span><br><span class="line">	err = db.Ping()</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">"数据库连接失败"</span>)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 预处理 SQL</span></span><br><span class="line">	stmt, err := db.Prepare(<span class="string">"INSERT INTO people VALUES(default, ?, ?)"</span>)</span><br><span class="line">	<span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">		<span class="keyword">if</span> stmt != <span class="literal">nil</span> &#123;</span><br><span class="line">			stmt.Close()</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;()</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">"预处理失败"</span>)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 参数和占位符对应</span></span><br><span class="line">	r, err := stmt.Exec(<span class="string">"杨金恒"</span>, <span class="string">"山西省运城市绛县"</span>)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">"SQL 执行失败"</span>, err)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 获取结果</span></span><br><span class="line">	count, err := r.RowsAffected()</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">"获取结果失败"</span>)</span><br><span class="line">	&#125; <span class="keyword">else</span> <span class="keyword">if</span> count &gt; <span class="number">0</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">"新增成功，受影响的行"</span>, count)</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">"新增失败"</span>)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="修改数据"><a href="#修改数据" class="headerlink" title="修改数据"></a>修改数据</h2><p>在 Go 语言的提供的 mysql 驱动中，如果修改前和修改后的数据内容是一致的，则认为受改变的行为 0，修改是失败的。</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"database/sql"</span></span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line">	_ <span class="string">"github.com/go-sql-driver/mysql"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// 新建驱动连接</span></span><br><span class="line">	db, err := sql.Open(<span class="string">"mysql"</span>, <span class="string">"root:123456@tcp(172.16.100.10:3306)/test"</span>)</span><br><span class="line">	<span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">		<span class="keyword">if</span> db != <span class="literal">nil</span> &#123;</span><br><span class="line">			db.Close()</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;()</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 测试连接</span></span><br><span class="line">	err = db.Ping()</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">"数据库连接失败"</span>)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 预处理 SQL</span></span><br><span class="line">	stmt, err := db.Prepare(<span class="string">"UPDATE people SET name=?, address=? WHERE id=?"</span>)</span><br><span class="line">	<span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">		<span class="keyword">if</span> stmt != <span class="literal">nil</span> &#123;</span><br><span class="line">			stmt.Close()</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;()</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">"预处理失败"</span>)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 参数和占位符对应</span></span><br><span class="line">	r, err := stmt.Exec(<span class="string">"杨大大"</span>, <span class="string">"陕西省西安市高新区"</span>, <span class="number">3</span>)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">"SQL 执行失败"</span>, err)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 获取结果</span></span><br><span class="line">	count, err := r.RowsAffected()</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">"获取结果失败"</span>)</span><br><span class="line">	&#125; <span class="keyword">else</span> <span class="keyword">if</span> count &gt; <span class="number">0</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">"修改成功，受影响的行"</span>, count)</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">"修改失败"</span>)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="删除数据"><a href="#删除数据" class="headerlink" title="删除数据"></a>删除数据</h2><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"database/sql"</span></span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line">	_ <span class="string">"github.com/go-sql-driver/mysql"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// 新建驱动连接</span></span><br><span class="line">	db, err := sql.Open(<span class="string">"mysql"</span>, <span class="string">"root:123456@tcp(172.16.100.10:3306)/test"</span>)</span><br><span class="line">	<span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">		<span class="keyword">if</span> db != <span class="literal">nil</span> &#123;</span><br><span class="line">			db.Close()</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;()</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 测试连接</span></span><br><span class="line">	err = db.Ping()</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">"数据库连接失败"</span>)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 预处理 SQL</span></span><br><span class="line">	stmt, err := db.Prepare(<span class="string">"DELETE FROM people WHERE id=?"</span>)</span><br><span class="line">	<span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">		<span class="keyword">if</span> stmt != <span class="literal">nil</span> &#123;</span><br><span class="line">			stmt.Close()</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;()</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">"预处理失败"</span>)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 参数和占位符对应</span></span><br><span class="line">	r, err := stmt.Exec(<span class="number">3</span>)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">"SQL 执行失败"</span>, err)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 获取结果</span></span><br><span class="line">	count, err := r.RowsAffected()</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">"获取结果失败"</span>)</span><br><span class="line">	&#125; <span class="keyword">else</span> <span class="keyword">if</span> count &gt; <span class="number">0</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">"删除，受影响的行"</span>, count)</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">"删除失败"</span>)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="数据查询"><a href="#数据查询" class="headerlink" title="数据查询"></a>数据查询</h2><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"database/sql"</span></span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line">	_ <span class="string">"github.com/go-sql-driver/mysql"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// 新建驱动连接</span></span><br><span class="line">	db, err := sql.Open(<span class="string">"mysql"</span>, <span class="string">"root:123456@tcp(172.16.100.10:3306)/test"</span>)</span><br><span class="line">	<span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">		<span class="keyword">if</span> db != <span class="literal">nil</span> &#123;</span><br><span class="line">			db.Close()</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;()</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 测试连接</span></span><br><span class="line">	err = db.Ping()</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">"数据库连接失败"</span>)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 预处理 SQL</span></span><br><span class="line">	stmt, err := db.Prepare(<span class="string">"SELECT * FROM people"</span>)</span><br><span class="line">	<span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">		<span class="keyword">if</span> stmt != <span class="literal">nil</span> &#123;</span><br><span class="line">			stmt.Close()</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;()</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">"预处理失败"</span>)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 获取查询结果集</span></span><br><span class="line">	rows, err := stmt.Query()</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">"获取结果失败"</span>)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">		<span class="keyword">if</span> rows != <span class="literal">nil</span> &#123;</span><br><span class="line">			rows.Close()</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;()</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 遍历结果集取出结果</span></span><br><span class="line">	<span class="keyword">for</span> rows.Next() &#123;</span><br><span class="line">		<span class="keyword">var</span> id <span class="keyword">int</span></span><br><span class="line">		<span class="keyword">var</span> name <span class="keyword">string</span></span><br><span class="line">		<span class="keyword">var</span> address <span class="keyword">string</span></span><br><span class="line">		rows.Scan(&amp;id, &amp;name, &amp;address)</span><br><span class="line">		fmt.Println(id, name, address)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="XML"><a href="#XML" class="headerlink" title="XML"></a>XML</h1><p>中文名称可扩展标记语言，用途有：数据存储、数据交互、配置文件，优点有：跨平台性、数据平整已读</p>
<h2 id="XML文档结构"><a href="#XML文档结构" class="headerlink" title="XML文档结构"></a>XML文档结构</h2><ol>
<li>第一行：XML 头、版本、编码</li>
<li>第二行：DTD 可选，能够检查 XML 内容是否满足要求</li>
<li>最外层标签 \&lt;peoples> 称为元素节点，根节点</li>
<li><p>\&lt;people> … \&lt;people> 整个标签称之为元素节点  </p>
</li>
<li><p>id=”1” 属性节点</p>
</li>
<li>标签中文字：文本节点</li>
</ol>
<h2 id="XML-文件示例"><a href="#XML-文件示例" class="headerlink" title="XML 文件示例"></a>XML 文件示例</h2><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>        <span class="comment">&lt;!-- 文档头 --&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE peoples SYSTEM "Note.dtd"&gt;</span>           <span class="comment">&lt;!-- 文档类型定义，语法检查器 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">peoples</span>&gt;</span>                                      <span class="comment">&lt;!-- 根节点 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">people</span> <span class="attr">id</span>=<span class="string">"1"</span>&gt;</span>                            <span class="comment">&lt;!-- id 是属性节点 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>张三<span class="tag">&lt;/<span class="name">name</span>&gt;</span>                       <span class="comment">&lt;!-- name 是一个元素节点 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">address</span>&gt;</span>海淀<span class="tag">&lt;/<span class="name">address</span>&gt;</span>                 <span class="comment">&lt;!-- 内部是文本节点 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">people</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">people</span> <span class="attr">id</span>=<span class="string">"2"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>李四<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">address</span>&gt;</span>朝阳<span class="tag">&lt;/<span class="name">address</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">people</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">peoples</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="语法要求"><a href="#语法要求" class="headerlink" title="语法要求"></a>语法要求</h2><ol>
<li><p>严格区分大小写</p>
</li>
<li><p>标签必须正确嵌套，必须正确关闭</p>
</li>
<li>必须有根节点</li>
<li>属性值必须有双引号</li>
<li>注释格式：\&lt;!– –></li>
</ol>
<h2 id="特殊字符"><a href="#特殊字符" class="headerlink" title="特殊字符"></a>特殊字符</h2><table>
<thead>
<tr>
<th>代码</th>
<th>特殊字符</th>
</tr>
</thead>
<tbody>
<tr>
<td>\&lt;</td>
<td>\&lt;</td>
</tr>
<tr>
<td>\&gt;</td>
<td>></td>
</tr>
<tr>
<td>\&amp;</td>
<td>\&amp;</td>
</tr>
<tr>
<td>\&apos;</td>
<td>\’</td>
</tr>
<tr>
<td>\&quot;</td>
<td>\”</td>
</tr>
</tbody>
</table>
<h2 id="序列化规则"><a href="#序列化规则" class="headerlink" title="序列化规则"></a>序列化规则</h2><ol>
<li><p>在 encodeing/xml 包下提供了对 xml 序列化和反序列化的 API</p>
</li>
<li><p>使用 Unmarshal 可以直接把 XML 字节切片数据转换为结构体</p>
</li>
<li><p>转换时按照特定的转换规则进行转换，且数据类型可以自动转换</p>
</li>
</ol>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="number">1.</span> 如果结构体字段类型为字符串或者 []<span class="keyword">byte</span>，且标签为，<span class="string">"innerxml"</span>, Unmarshal 函数直接将对原始 XML 文本写入该字段，其余规则仍适用。</span><br><span class="line"><span class="number">2.</span> 如果结构体字段类型为 xml.Name 且名为 XMLName ，Unmarshal 会将元素写入该字段</span><br><span class="line"><span class="number">3.</span> 如果字段 XMLName 的标签格式为 <span class="string">"name"</span> 或 <span class="string">"namespace-URL name"</span>，XML 元素必须有给定的名字（以及可选的名字空间），否则 Unmarshal 返回错误</span><br><span class="line"><span class="number">4.</span> 如果 XML 元素的属性名匹配某个标签，<span class="string">",attr"</span> 为字段的字段名，或者匹配某个标签为 <span class="string">"name,attr"</span> 的字段的标签名，Unmarshal 会将该属性的值写入该字段。</span><br><span class="line"><span class="number">5.</span> 如果 XML 元素包含字符数据，该数据会存入结构体中第一个具有标签 <span class="string">",chardata"</span> 的字段中，该字段可以是字符串类型或者 []<span class="keyword">byte</span> 类型。如果没有这样的字段，字符数据会丢弃。</span><br><span class="line"><span class="number">6.</span> 如果 XML 元素包含一个子元素，其名称匹配格式为 <span class="string">"a"</span> 或者 <span class="string">"a&gt;b&gt;c"</span> 的标签的前缀，反序列化会深入 XML 结构中寻找具有指定名称的元素，并将最后端的元素映射到该标签所在的结构体字段，以 <span class="string">"&gt;"</span> 开始的标签等价于以字段名开始并紧跟着 <span class="string">"&gt;"</span> 的标签。</span><br><span class="line"><span class="number">7.</span> 如果 XML 元素包含一个子元素，其名称匹配够格结构体字段的字段名，且该字段没有任何模式选项（<span class="string">",attr"</span>、<span class="string">",chardata"</span> 等），Unmarshal 会将该元素映射到该字段。</span><br><span class="line"><span class="number">8.</span> 如果 XML 元素包含的某个子元素不匹配以上任何一条，而存在某个字段其标签为 <span class="string">",any"</span>，Unmarshal 会将该元素映射到该字段。</span><br><span class="line"><span class="number">9.</span> 匿名字段被处理为其字段好像位于外层结构体中一样。</span><br><span class="line"><span class="number">10.</span> 标签为 <span class="string">"-"</span> 的结构体字段永远不会被反序列化填写。</span><br></pre></td></tr></table></figure>
<h2 id="XML-文件读取"><a href="#XML-文件读取" class="headerlink" title="XML 文件读取"></a>XML 文件读取</h2><p>本示例是从 XML 文件中将数据读取出来，并转换为结构体对象</p>
<ul>
<li>people.xml</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span><br><span class="line">&lt;people id=&quot;1&quot;&gt;</span><br><span class="line">    &lt;name&gt;杨金恒&lt;/name&gt;</span><br><span class="line">    &lt;address&gt;山西绛县&lt;/address&gt;</span><br><span class="line">&lt;/people&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li>main.go</li>
</ul>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> People <span class="keyword">struct</span> &#123;</span><br><span class="line">	XMLName xml.Name <span class="string">`xml:"people"`</span>         <span class="comment">// 决定了外层标签名</span></span><br><span class="line">	Id      <span class="keyword">int</span>      <span class="string">`xml:id,attr`</span>          <span class="comment">// 决定了外层标签的 ID</span></span><br><span class="line">	Name    <span class="keyword">string</span>   <span class="string">`xml:"name"`</span>           <span class="comment">// 元素</span></span><br><span class="line">	Address <span class="keyword">string</span>   <span class="string">`xml:"address"`</span>        <span class="comment">// 元素</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	peo := <span class="built_in">new</span>(People)</span><br><span class="line">	b, _ := ioutil.ReadFile(<span class="string">"people.xml"</span>)</span><br><span class="line">	xml.Unmarshal(b, peo)</span><br><span class="line">	fmt.Println(*peo)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line">&amp;#<span class="number">123</span>;&amp;#<span class="number">123</span>; people&#125; <span class="number">0</span> 杨金恒 山西绛县&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>复杂的例子 people.xml</li>
</ul>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">peoples</span> <span class="attr">version</span>=<span class="string">"0.9"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">people</span> <span class="attr">id</span>=<span class="string">"1"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>杨金恒<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">address</span>&gt;</span>山西绛县<span class="tag">&lt;/<span class="name">address</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">people</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">people</span> <span class="attr">id</span>=<span class="string">"2"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>杨中校<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">address</span>&gt;</span>北京朝阳<span class="tag">&lt;/<span class="name">address</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">people</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">oeoples</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>复杂的例子 main.go</li>
</ul>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> Peoples <span class="keyword">struct</span> &#123;</span><br><span class="line">	XMLName xml.Name <span class="string">`xml:"peoples"`</span></span><br><span class="line">	Version <span class="keyword">string</span>   <span class="string">`xml:"version,attr"`</span></span><br><span class="line">	Peos    []People <span class="string">`xml:"people"`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> People <span class="keyword">struct</span> &#123;</span><br><span class="line">	XMLName xml.Name <span class="string">`xml:"people"`</span></span><br><span class="line">	Id      <span class="keyword">int</span>      <span class="string">`xml:"id,attr"`</span></span><br><span class="line">	Name    <span class="keyword">string</span>   <span class="string">`xml:"name"`</span></span><br><span class="line">	Address <span class="keyword">string</span>   <span class="string">`xml:"address"`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	peo := <span class="built_in">new</span>(Peoples)</span><br><span class="line">	b, _ := ioutil.ReadFile(<span class="string">"people.xml"</span>)</span><br><span class="line">	xml.Unmarshal(b, peo)</span><br><span class="line">	fmt.Println(*peo)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line">&amp;#<span class="number">123</span>;&amp;#<span class="number">123</span>; peoples&#125; <span class="number">0.9</span> [&amp;#<span class="number">123</span>;&amp;#<span class="number">123</span>; people&#125; <span class="number">0</span> 杨金恒 山西绛县&#125; &amp;#<span class="number">123</span>;&amp;#<span class="number">123</span>; people&#125; <span class="number">0</span> 杨中校 北京朝阳&#125;]&#125;</span><br></pre></td></tr></table></figure>
<h2 id="XML-文件生成"><a href="#XML-文件生成" class="headerlink" title="XML 文件生成"></a>XML 文件生成</h2><p>本节例子为将结构体数据转换为 XML 文件</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">type</span> People <span class="keyword">struct</span> &#123;</span><br><span class="line">		XMLName xml.Name <span class="string">`xml:"people"`</span></span><br><span class="line">		Id      <span class="keyword">int</span>      <span class="string">`xml:"id,attr"`</span></span><br><span class="line">		Name    <span class="keyword">string</span>   <span class="string">`xml:"name"`</span></span><br><span class="line">		Address <span class="keyword">string</span>   <span class="string">`xml:"address"`</span></span><br><span class="line">	&#125;</span><br><span class="line">	peo := People&#123;Id: <span class="number">1</span>, Name: <span class="string">"杨金恒"</span>, Address: <span class="string">"北京海淀"</span>&#125;</span><br><span class="line">	b, _ := xml.MarshalIndent(peo, <span class="string">""</span>, <span class="string">"    "</span>) <span class="comment">// 第二个参数是每行开头的字符，第三个参数是缩进的字符</span></span><br><span class="line">	b = <span class="built_in">append</span>([]<span class="keyword">byte</span>(xml.Header), b...)       <span class="comment">// 追加 XML 文档头</span></span><br><span class="line">	ioutil.WriteFile(<span class="string">"write_people.xml"</span>, b, <span class="number">755</span>)  <span class="comment">// 写入到本地文件</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">people</span> <span class="attr">id</span>=<span class="string">"1"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>杨金恒<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">address</span>&gt;</span>北京海淀<span class="tag">&lt;/<span class="name">address</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">people</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h1 id="logger"><a href="#logger" class="headerlink" title="logger"></a>logger</h1><p>使用开发工具时，控制台打印的信息就是日志信息，在 Go 语言中提供了 log 包对日志的支持。</p>
<p>日志的输出级别：</p>
<ol>
<li><p>Print() 输出日志信息</p>
</li>
<li><p>Panic() 打印日志信息，并触发 Panic，日志信息为 Panic 信息</p>
</li>
<li>Fatal() 打印日志信息后调用 os.Exit(0)</li>
</ol>
<p>所有的日志信息打印时都带有时间，且颜色为红色，每种日志级别都提供了三个函数：</p>
<ol>
<li>Println()</li>
<li>Print()</li>
<li>Printf()</li>
</ol>
<h2 id="打印日志信息"><a href="#打印日志信息" class="headerlink" title="打印日志信息"></a>打印日志信息</h2><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	log.Println(<span class="string">"打印普通日志信息"</span>)    <span class="comment">// 打印普通日志</span></span><br><span class="line">	log.Panic(<span class="string">"打印 Panic 日志信息"</span>) <span class="comment">// 打印日志完毕后，会抛出 Panic 异常</span></span><br><span class="line">	log.Fatal(<span class="string">"打印 Panic 日志信息"</span>) <span class="comment">// 打印完毕，会直接终止程序</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="number">2019</span>/<span class="number">10</span>/<span class="number">05</span> <span class="number">00</span>:<span class="number">22</span>:<span class="number">47</span> 打印普通日志信息</span><br><span class="line"><span class="number">2019</span>/<span class="number">10</span>/<span class="number">05</span> <span class="number">00</span>:<span class="number">22</span>:<span class="number">47</span> 打印 Panic 日志信息</span><br><span class="line"><span class="built_in">panic</span>: 打印 Panic 日志信息</span><br><span class="line"></span><br><span class="line">goroutine <span class="number">1</span> [running]:</span><br><span class="line">log.Panic(<span class="number">0xc00008bf</span>40, <span class="number">0x1</span>, <span class="number">0x1</span>)</span><br><span class="line">	D:/Program Files/Go/src/log/log.<span class="keyword">go</span>:<span class="number">338</span> +<span class="number">0xb3</span></span><br><span class="line">main.main()</span><br><span class="line">	c:/Users/LENOVO/OneDrive/文档/笔记~Go语言/loging/main.<span class="keyword">go</span>:<span class="number">7</span> +<span class="number">0xa8</span></span><br></pre></td></tr></table></figure>
<h2 id="打印日志到文件"><a href="#打印日志到文件" class="headerlink" title="打印日志到文件"></a>打印日志到文件</h2><p>输出日志时的几种状态</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> (</span><br><span class="line">	Ldate         = <span class="number">1</span> &lt;&lt; <span class="literal">iota</span>     <span class="comment">// 本地日期</span></span><br><span class="line">	Ltime                         <span class="comment">// 本地时间</span></span><br><span class="line">	Lmicroseconds                 <span class="comment">// 毫秒时间</span></span><br><span class="line">    Llongfile                     <span class="comment">// 日志文件和行号 /log/access.log:23</span></span><br><span class="line">	Lshortfile                    <span class="comment">// 最终文件名元素和行号：/log/access.log:23。 覆盖Llongfile</span></span><br><span class="line">	LUTC                          <span class="comment">// 如果设置了日期或时间，请使用UTC而不是本地时区</span></span><br><span class="line">	LstdFlags     = Ldate | Ltime <span class="comment">// 标准记录器的初始值</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	f, _ := os.OpenFile(<span class="string">"d:/golang.log"</span>, os.O_APPEND|os.O_CREATE, <span class="number">0755</span>)</span><br><span class="line">	logger := log.New(f, <span class="string">"[INFO]"</span>, log.Ltime)</span><br><span class="line">	logger.Println(<span class="string">"打印日志信息"</span>)</span><br><span class="line">	fmt.Println()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="http-服务器"><a href="#http-服务器" class="headerlink" title="http 服务器"></a>http 服务器</h1><ol>
<li>HandleFunc 可以设置函数的请求路径</li>
</ol>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// HandleFunc registers the handler function for the given pattern</span></span><br><span class="line"><span class="comment">// in the DefaultServeMux.</span></span><br><span class="line"><span class="comment">// The documentation for ServeMux explains how patterns are matched.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">HandleFunc</span><span class="params">(pattern <span class="keyword">string</span>, handler <span class="keyword">func</span>(ResponseWriter, *Request)</span>)</span> &#123;</span><br><span class="line">	DefaultServeMux.HandleFunc(pattern, handler)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>ListenAndServe 实现了监听服务</li>
</ol>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ListenAndServe always returns a non-nil error.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">ListenAndServe</span><span class="params">(addr <span class="keyword">string</span>, handler Handler)</span> <span class="title">error</span></span> &#123;</span><br><span class="line">	server := &amp;Server&#123;Addr: addr, Handler: handler&#125;</span><br><span class="line">	<span class="keyword">return</span> server.ListenAndServe()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>第一个 Go web 项目</li>
</ul>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	<span class="string">"net/http"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">welcome</span><span class="params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;</span><br><span class="line">	w.Header().Set(<span class="string">"Content-Type"</span>, <span class="string">"text/html;charset=utf-8"</span>)</span><br><span class="line">	fmt.Fprint(w, <span class="string">"&lt;h1&gt;服务器返回的信息&lt;/h1&gt;"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	http.HandleFunc(<span class="string">"/"</span>, welcome)</span><br><span class="line">	http.ListenAndServe(<span class="string">"127.0.0.1:8080"</span>, <span class="literal">nil</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="单控制器"><a href="#单控制器" class="headerlink" title="单控制器"></a>单控制器</h2><p>在 Go 语言的 net/http 包下有 ServeMux 实现了 Front 设计模式的 Front 窗口，ServeMux 负责接收请求并把请求分发给处理器（Handler）</p>
<ol>
<li>Http.ServeMux 源码实现了 Handler 接口</li>
</ol>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> Handler <span class="keyword">interface</span> &#123;                     <span class="comment">// 处理一个请求的处理器</span></span><br><span class="line">	ServeHTTP(ResponseWriter, *Request)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> ServeMux <span class="keyword">struct</span> &#123;                      <span class="comment">// ServeMux 结构体</span></span><br><span class="line">	mu    sync.RWMutex</span><br><span class="line">	m     <span class="keyword">map</span>[<span class="keyword">string</span>]muxEntry</span><br><span class="line">	es    []muxEntry <span class="comment">// slice of entries sorted from longest to shortest.</span></span><br><span class="line">	hosts <span class="keyword">bool</span>       <span class="comment">// whether any patterns contain hostnames</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ServeMux 结构体重写了 ServeHTTP 这个方法，就是 ServeMux 结构体实现了 ServeHTTP 方法</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(mux *ServeMux)</span> <span class="title">ServeHTTP</span><span class="params">(w ResponseWriter, r *Request)</span></span> &#123;</span><br><span class="line">	<span class="keyword">if</span> r.RequestURI == <span class="string">"*"</span> &#123;</span><br><span class="line">		<span class="keyword">if</span> r.ProtoAtLeast(<span class="number">1</span>, <span class="number">1</span>) &#123;</span><br><span class="line">			w.Header().Set(<span class="string">"Connection"</span>, <span class="string">"close"</span>)</span><br><span class="line">		&#125;</span><br><span class="line">		w.WriteHeader(StatusBadRequest)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">	h, _ := mux.Handler(r)</span><br><span class="line">	h.ServeHTTP(w, r)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>自定义结构体，实现 Handler 接口后，这个结构体就属于一个处理器，可以处理请求</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	<span class="string">"net/http"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Myhandeler <span class="keyword">struct</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(mh *Myhandeler)</span> <span class="title">ServeHTTP</span><span class="params">(res http.ResponseWriter, req *http.Request)</span></span> &#123;</span><br><span class="line">	fmt.Fprintln(res, <span class="string">"输出内容"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	myhandeler := Myhandeler&#123;&#125;</span><br><span class="line">	server := http.Server&#123;</span><br><span class="line">		Addr:    <span class="string">"127.0.0.1:8090"</span>,</span><br><span class="line">		Handler: &amp;myhandeler,</span><br><span class="line">	&#125;</span><br><span class="line">	server.ListenAndServe()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="多控制器"><a href="#多控制器" class="headerlink" title="多控制器"></a>多控制器</h2><p>在实际开发中，必须有多个控制器，来区分业务，Go 语言中支持两种处理方式</p>
<ol>
<li>多个处理器（Handler）</li>
<li>多个处理函数（HandleFunc）</li>
</ol>
<h3 id="使用多处理器"><a href="#使用多处理器" class="headerlink" title="使用多处理器"></a>使用多处理器</h3><p>使用 Http.Handler 把不同的 URL 绑定到不同的处理器，在浏览器输入：/myhandler 或者 /myother 可以访问两个处理器，访问其他出现 404</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"net/http"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Myhandeler <span class="keyword">struct</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Myother <span class="keyword">struct</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(mh *Myhandeler)</span> <span class="title">ServeHTTP</span><span class="params">(res http.ResponseWriter, req *http.Request)</span></span> &#123;</span><br><span class="line">	res.Write([]<span class="keyword">byte</span>(<span class="string">"&lt;h1&gt;Myhandeler 输出内容&lt;/h1&gt;"</span>))</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(mh *Myother)</span> <span class="title">ServeHTTP</span><span class="params">(res http.ResponseWriter, req *http.Request)</span></span> &#123;</span><br><span class="line">	res.Write([]<span class="keyword">byte</span>(<span class="string">"&lt;h1&gt;Myother 输出内容&lt;/h1&gt;"</span>))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	myhandeler := Myhandeler&#123;&#125;</span><br><span class="line">	myother := Myother&#123;&#125;</span><br><span class="line">	server := http.Server&#123;Addr: <span class="string">"127.0.0.1:8080"</span>&#125;</span><br><span class="line">	http.Handle(<span class="string">"/myhandler"</span>, &amp;myhandeler)</span><br><span class="line">	http.Handle(<span class="string">"/myother"</span>, &amp;myother)</span><br><span class="line">	server.ListenAndServe()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="多处理器函数"><a href="#多处理器函数" class="headerlink" title="多处理器函数"></a>多处理器函数</h3><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"net/http"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">myhandler</span><span class="params">(res http.ResponseWriter, req *http.Request)</span></span> &#123;</span><br><span class="line">	res.Write([]<span class="keyword">byte</span>(<span class="string">"&lt;h1&gt;Myhandeler 输出内容&lt;/h1&gt;"</span>))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">myother</span><span class="params">(res http.ResponseWriter, req *http.Request)</span></span> &#123;</span><br><span class="line">	res.Write([]<span class="keyword">byte</span>(<span class="string">"&lt;h1&gt;Myother 输出内容&lt;/h1&gt;"</span>))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	server := http.Server&#123;Addr: <span class="string">"127.0.0.1:8080"</span>&#125;</span><br><span class="line">	http.HandleFunc(<span class="string">"/myhandler"</span>, myhandler)</span><br><span class="line">	http.HandleFunc(<span class="string">"/myother"</span>, myother)</span><br><span class="line">	server.ListenAndServe()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="获取请求头和参数"><a href="#获取请求头和参数" class="headerlink" title="获取请求头和参数"></a>获取请求头和参数</h2><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"net/http"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">handler</span><span class="params">(res http.ResponseWriter, req *http.Request)</span></span> &#123;</span><br><span class="line">	<span class="comment">// 设置响应头</span></span><br><span class="line">	res.Header().Set(<span class="string">"Content-Type"</span>, <span class="string">"text/html;charset=utf-8"</span>)</span><br><span class="line"></span><br><span class="line">	res.Write([]<span class="keyword">byte</span>(<span class="string">"&lt;h3&gt;请求头的信息&lt;/h3&gt;"</span>))</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 请求头</span></span><br><span class="line">	header := req.Header</span><br><span class="line">	<span class="keyword">for</span> k, v := <span class="keyword">range</span> header &#123;</span><br><span class="line">		key := []<span class="keyword">byte</span>(k)</span><br><span class="line">		res.Write(key)</span><br><span class="line">		res.Write([]<span class="keyword">byte</span>(<span class="string">" -&gt; "</span>))</span><br><span class="line">		<span class="keyword">for</span> _, v := <span class="keyword">range</span> v &#123;</span><br><span class="line">			res.Write([]<span class="keyword">byte</span>(v))</span><br><span class="line">			res.Write([]<span class="keyword">byte</span>(<span class="string">"&amp;nbsp;"</span>))</span><br><span class="line">		&#125;</span><br><span class="line">		res.Write([]<span class="keyword">byte</span>(<span class="string">"&lt;/br&gt;"</span>))</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	res.Write([]<span class="keyword">byte</span>(<span class="string">"&lt;h3&gt;请求参数的信息&lt;/h3&gt;"</span>))</span><br><span class="line">	<span class="comment">// 请求参数</span></span><br><span class="line">	req.ParseForm()</span><br><span class="line">	form := req.Form</span><br><span class="line">	<span class="keyword">for</span> k, _ := <span class="keyword">range</span> form &#123;</span><br><span class="line">		key := []<span class="keyword">byte</span>(k)</span><br><span class="line">		res.Write(key)</span><br><span class="line">		res.Write([]<span class="keyword">byte</span>(<span class="string">" -&gt; "</span>))</span><br><span class="line">		res.Write([]<span class="keyword">byte</span>(req.FormValue(k)))</span><br><span class="line">		<span class="comment">// for _, v := range v &#123;</span></span><br><span class="line">		<span class="comment">// 	res.Write([]byte(v))</span></span><br><span class="line">		<span class="comment">// 	res.Write([]byte("&amp;nbsp;"))</span></span><br><span class="line">		<span class="comment">// &#125;</span></span><br><span class="line">		res.Write([]<span class="keyword">byte</span>(<span class="string">"&lt;/br&gt;"</span>))</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	server := http.Server&#123;Addr: <span class="string">"127.0.0.1:8080"</span>&#125;</span><br><span class="line">	http.HandleFunc(<span class="string">"/handler"</span>, handler)</span><br><span class="line">	server.ListenAndServe()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="项目结构"><a href="#项目结构" class="headerlink" title="项目结构"></a>项目结构</h2><ul>
<li>站点的文件组织</li>
</ul>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line">web/</span><br><span class="line">├── main.<span class="keyword">go</span>                              <span class="comment">// main 函数</span></span><br><span class="line">├── src                                  <span class="comment">// go 源码文件</span></span><br><span class="line">├── static                               <span class="comment">// 静态文件资源</span></span><br><span class="line">│   ├── css</span><br><span class="line">│   ├── images</span><br><span class="line">│   └── js</span><br><span class="line">│       └── main.js</span><br><span class="line">└── templates                            <span class="comment">// 模板文件目录</span></span><br><span class="line">    └── index.html</span><br></pre></td></tr></table></figure>
<h2 id="html-模板"><a href="#html-模板" class="headerlink" title="html 模板"></a>html 模板</h2><ul>
<li>静态文件：static/js/main.js</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">button = <span class="built_in">document</span>.querySelector(<span class="string">".button"</span>);</span><br><span class="line"></span><br><span class="line">button.addEventListener(<span class="string">"click"</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    alert(<span class="string">"点击了按钮"</span>);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<ul>
<li>模板文件：templates/index.html</li>
</ul>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=<span class="string">"en"</span>&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">"UTF-8"</span>&gt;</span><br><span class="line">    &lt;meta name=<span class="string">"viewport"</span> content=<span class="string">"width=device-width, initial-scale=1.0"</span>&gt;</span><br><span class="line">    &lt;meta http-equiv=<span class="string">"X-UA-Compatible"</span> content=<span class="string">"ie=edge"</span>&gt;</span><br><span class="line">    &lt;title&gt;Document&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;h2&gt;Hello Golang&lt;/h2&gt;</span><br><span class="line">    &lt;input <span class="keyword">type</span>=<span class="string">"button"</span> value=<span class="string">"æŒ‰é’®"</span> class=<span class="string">"button"</span>/&gt;</span><br><span class="line">    &lt;script src="/static/js/main.js"&gt;&lt;/script&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li>main.go</li>
</ul>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"html/template"</span></span><br><span class="line">	<span class="string">"net/http"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">handler</span><span class="params">(res http.ResponseWriter, req *http.Request)</span></span> &#123;</span><br><span class="line">	t, _ := template.ParseFiles(<span class="string">"templates/index.html"</span>)</span><br><span class="line">	t.Execute(res, <span class="literal">nil</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	server := http.Server&#123;Addr: <span class="string">"127.0.0.1:8080"</span>&#125;</span><br><span class="line">	<span class="comment">// 让静态文件服务生效</span></span><br><span class="line">	http.Handle(<span class="string">"/static/"</span>, http.StripPrefix(<span class="string">"/static/"</span>, http.FileServer(http.Dir(<span class="string">"static"</span>))))</span><br><span class="line">	http.HandleFunc(<span class="string">"/handler"</span>, handler)</span><br><span class="line">	server.ListenAndServe()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="使用模板传递数据"><a href="#使用模板传递数据" class="headerlink" title="使用模板传递数据"></a>使用模板传递数据</h1><p>在 html/template 中的第二个参数 template. Execute(res, <strong>value</strong>) 可以向模板传递值。</p>
<p>模板语法中的 . 是一个指针，它指向当前变量，称为 “dot”，也就是 Execute 方法的第二个参数。</p>
<h2 id="模板语法"><a href="#模板语法" class="headerlink" title="模板语法"></a>模板语法</h2><ul>
<li>语法规范</li>
</ul>
<table>
<thead>
<tr>
<th>语法</th>
</tr>
</thead>
<tbody>
<tr>
<td>1. Go 语法的布尔值、字符串、字符、整数、浮点数、虚数、复数、视作无类型的字面量，字符串不能跨行</td>
</tr>
<tr>
<td>2. 关键字 nil 代表 Go 的无类型的 nil 值</td>
</tr>
<tr>
<td>3. 字符 . 使用时不加单引号，代表 dot 的值</td>
</tr>
<tr>
<td>4. 变量名，以 $ 符号起始，例如 $var1 执行结果为变量的值</td>
</tr>
<tr>
<td>5. 结构体数据的字段名称，直接使用 . 来引用，支持链式调用 . Field1. Field2，也支持 $var. Field</td>
</tr>
<tr>
<td>6. 字典类型数据的键名，以 . 开始例如：.key 执行结果为成员的值，也支持链式调用</td>
</tr>
<tr>
<td>7. 数据的无参数方法名，以 . 开始，例如 . Method 执行结果为 dot 调用该方法的值</td>
</tr>
<tr>
<td>8. 无参数的函数名，如 func 执行结果是该函数的返回值 func()</td>
</tr>
<tr>
<td>9. 上面某一条加上括弧（用于分组）执行结果可以访问其字段或者键对应的值，如：(. StructValueMethod “arg”). Field</td>
</tr>
</tbody>
</table>
<ul>
<li>action，其中 pipeline 代表数据的执行结果</li>
</ul>
<table>
<thead>
<tr>
<th>动作</th>
<th>解释</th>
</tr>
</thead>
<tbody>
<tr>
<td>&#123;&#123;pipeline&#125;&#125;</td>
<td>pipeline 的值的默认文本会被拷贝到输出里</td>
</tr>
<tr>
<td>&#123;&#123;if pipeline&#125;&#125; T1 &#123;&#123;end&#125;&#125;</td>
<td>如果 pipline 的值为 empty 不产生输出，否则输出 T1 的执行结果，不改变 dot 值</td>
</tr>
<tr>
<td>&#123;&#123;if pipline&#125;&#125; T1 &#123;&#123;else if pipline&#125;&#125; T0 &#123;&#123;end&#125;&#125;</td>
<td>用于简化 if-else，else action 可以直接包含另一个 if，等价于 &#123;&#123;if pipline&#125;&#125; T1 &#123;&#123;else&#125;&#125; &#123;&#123;if pipline&#125;&#125; T0 &#123;&#123;end&#125;&#125;&#123;&#123;end&#125;&#125;</td>
</tr>
<tr>
<td>&#123;&#123;range pipline&#125;&#125; T1 &#123;&#123;end&#125;&#125;</td>
<td>pipline 的值必须是数组、切片、字典或者通道。如果 pipline 的值其长度为 0 不会有任何输出，否则 dot 依次设为数组、切片、字典、或者通道的每一个元素并执行 T1</td>
</tr>
<tr>
<td>&#123;&#123;range pipline&#125;&#125; T1 &#123;&#123;else&#125;&#125; T0 &#123;&#123;`end&#125;&#125;</td>
<td>pipline 的值必须是数组、切片、字典、或者通道、如果 pipline 的值其长度为 0，不改变 dot 的值并执行 T0 否则会修改 dot 并执行 T1</td>
</tr>
<tr>
<td>&#123;&#123;template “name”&#125;&#125;</td>
<td>执行名为 name 的模板，并提供给模板的参数为 nil 如果模板不存在则输出 “”</td>
</tr>
<tr>
<td>&#123;&#123;template “name” pipline&#125;&#125;</td>
<td>执行名为 name 的模板，提供给模板的参数为 pipline 的值</td>
</tr>
<tr>
<td>&#123;&#123;with pipline&#125;&#125; T1 &#123;&#123;end&#125;&#125;</td>
<td>如果 pipline 为 empty 不产生输出，否则 dot 将设为 pipline 的值并执行 T1 ，不修改外面的 dot</td>
</tr>
<tr>
<td>&#123;&#123;with pipline&#125;&#125; T1 &#123;&#123;else&#125;&#125; T0 &#123;&#123;end&#125;&#125;</td>
<td>如果 pipline 为 empty 不改变 dot 并执行 T0，否则 dot 设为 pipline 的值并执行 T1</td>
</tr>
</tbody>
</table>
<h2 id="结构体示例"><a href="#结构体示例" class="headerlink" title="结构体示例"></a>结构体示例</h2><ul>
<li>模板中的成员变量必须是大写才能被取得</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;h2&gt;&amp;#123;&amp;#123;.Name&amp;#125;&amp;#125; &amp;#123;&amp;#123;.Age&amp;#125;&amp;#125;&lt;/h2&gt;</span><br><span class="line">&lt;/body&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li>注意结构体的成员属性必须大写，才能被模板单独取得</li>
</ul>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> User <span class="keyword">struct</span> &#123;</span><br><span class="line">	Name <span class="keyword">string</span></span><br><span class="line">	Age  <span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">handler</span><span class="params">(res http. ResponseWriter, req *http. Request)</span></span> &#123;</span><br><span class="line">	t, _ := template.ParseFiles(<span class="string">"templates/index.html"</span>)</span><br><span class="line">	t.Execute(res, User&#123;Name: <span class="string">"杨金恒"</span>, Age: <span class="number">30</span>&#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Map-类型示例"><a href="#Map-类型示例" class="headerlink" title="Map 类型示例"></a>Map 类型示例</h2><ul>
<li>map 使用键来映射，它的成员不需要首字母大写</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;h2&gt;&amp;#123;&amp;#123;.user.Name&amp;#125;&amp;#125; &amp;#123;&amp;#123;.user.Age&amp;#125;&amp;#125;&lt;/h2&gt;</span><br><span class="line">    &lt;h2&gt;&amp;#123;&amp;#123;.info&amp;#125;&amp;#125;&lt;/h2&gt;</span><br><span class="line">&lt;/body&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li>使用链式调用成员属性</li>
</ul>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> User <span class="keyword">struct</span> &#123;</span><br><span class="line">	Name <span class="keyword">string</span></span><br><span class="line">	Age  <span class="keyword">int</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">handler</span><span class="params">(res http. ResponseWriter, req *http. Request)</span></span> &#123;</span><br><span class="line">	t, _ := template.ParseFiles(<span class="string">"templates/index.html"</span>)</span><br><span class="line">	m := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">interface</span>&#123;&#125;)</span><br><span class="line">	m[<span class="string">"user"</span>] = User&#123;Name: <span class="string">"杨金恒"</span>, Age: <span class="number">30</span>&#125;</span><br><span class="line">	m[<span class="string">"info"</span>] = <span class="string">"yangjinheng is a very bad ma, hahahahahhaha"</span></span><br><span class="line">	t.Execute(res, m)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="方法类型示例"><a href="#方法类型示例" class="headerlink" title="方法类型示例"></a>方法类型示例</h2><p>在模板中调用函数的时候，如果没有参数，直接使用函数名称即可，无需添加()</p>
<p>如果调用有参数函数时候，参数和函数名称之间有空格，参数和参数之间也是空格</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>&amp;#123;&amp;#123;.Year&amp;#125;&amp;#125;<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>&amp;#123;&amp;#123;.Month&amp;#125;&amp;#125;<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>&amp;#123;&amp;#123;.Day&amp;#125;&amp;#125;<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>&amp;#123;&amp;#123;.Day&amp;#125;&amp;#125;<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>&amp;#123;&amp;#123;.Format "2006-01-02 15:04:05"&amp;#125;&amp;#125;<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">handler</span><span class="params">(res http. ResponseWriter, req *http. Request)</span></span> &#123;</span><br><span class="line">	t, _ := template.ParseFiles(<span class="string">"templates/index.html"</span>)</span><br><span class="line">	time1 := time.Date(<span class="number">2019</span>, <span class="number">10</span>, <span class="number">13</span>, <span class="number">17</span>, <span class="number">11</span>, <span class="number">20</span>, <span class="number">0</span>, time.Local)</span><br><span class="line">	t.Execute(res, time1)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="自定义函数类型"><a href="#自定义函数类型" class="headerlink" title="自定义函数类型"></a>自定义函数类型</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;h2&gt;&amp;#123;&amp;#123;.&amp;#125;&amp;#125;&lt;/h2&gt;</span><br><span class="line">    &lt;h2&gt;&amp;#123;&amp;#123;ft .&amp;#125;&amp;#125;&lt;/h2&gt;</span><br><span class="line">&lt;/body&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	<span class="string">"html/template"</span></span><br><span class="line">	<span class="string">"net/http"</span></span><br><span class="line">	<span class="string">"time"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">MyTransfer</span><span class="params">(t time. Time)</span> <span class="title">string</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> t.Format(<span class="string">"2006-01-02 15:04:05"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">handler</span><span class="params">(res http. ResponseWriter, req *http. Request)</span></span> &#123;</span><br><span class="line">	<span class="comment">// 绑定自定义函数到 FuncMap 上</span></span><br><span class="line">	fm := template.FuncMap&#123;<span class="string">"ft"</span>: MyTransfer&#125;</span><br><span class="line">	<span class="comment">// 新建空的模板对象，绑定函数</span></span><br><span class="line">	t := template.New(<span class="string">"index.html"</span>).Funcs(fm)</span><br><span class="line">	t, _ = t.ParseFiles(<span class="string">"templates/index.html"</span>)</span><br><span class="line">	<span class="comment">// 新建时间</span></span><br><span class="line">	time1 := time.Date(<span class="number">2019</span>, <span class="number">10</span>, <span class="number">13</span>, <span class="number">17</span>, <span class="number">11</span>, <span class="number">20</span>, <span class="number">0</span>, time.Local)</span><br><span class="line">	t.Execute(res, time1)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	server := http.Server&#123;Addr: <span class="string">"127.0.0.1:8080"</span>&#125;</span><br><span class="line">	http.Handle(<span class="string">"/static/"</span>, http.StripPrefix(<span class="string">"/static/"</span>, http.FileServer(http.Dir(<span class="string">"static"</span>))))</span><br><span class="line">	http.HandleFunc(<span class="string">"/"</span>, handler)</span><br><span class="line">	server.ListenAndServe()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="if-条件示例"><a href="#if-条件示例" class="headerlink" title="if 条件示例"></a>if 条件示例</h2><p>布尔函数会将任何类型的零值视作假，其余视为真，if 后面的表达式中如果包含逻辑控制符在模板中实际上是全局函数。</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line">and、or、not、<span class="built_in">len</span>、index、<span class="built_in">print</span>、printf、<span class="built_in">println</span>，等这些</span><br><span class="line">html        <span class="comment">// 返回其参数文本表示的 HTML 逸码等价表示</span></span><br><span class="line">urlquery    <span class="comment">// 返回其参数文本表示的可嵌入 URL 查询的逸码等价表示</span></span><br><span class="line">js          <span class="comment">// 返回其参数文本表示的 javascript 逸码等价表示</span></span><br><span class="line">call        <span class="comment">// 执行结果是调用第一个参数的返回值、该参数必须是函数类型，其余参数作为调用该函数的参数</span></span><br><span class="line">            <span class="comment">// 例如：call .x .y 1 2 等价于 go 语言中的 dot.X.Y(1,2)</span></span><br><span class="line">            <span class="comment">// call 的第一个参数的执行结果必须是函数类型的值</span></span><br></pre></td></tr></table></figure>
<ul>
<li>第一个参数相当左值，第二个参数相当于右值，例如 ne 1 2 等价于 1 != 2</li>
</ul>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line">eq          <span class="comment">// 等于</span></span><br><span class="line">ne          <span class="comment">// 不等于</span></span><br><span class="line">lt          <span class="comment">// 小于</span></span><br><span class="line">le          <span class="comment">// 小于等于</span></span><br><span class="line">gt          <span class="comment">// 大于</span></span><br><span class="line">ge          <span class="comment">// 大于等于</span></span><br></pre></td></tr></table></figure>
<ul>
<li>if elseif 示例</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;body&gt;</span><br><span class="line">    &amp;#123;&amp;#123;$name:=&quot;杨金恒&quot;&amp;#125;&amp;#125;</span><br><span class="line">    &amp;#123;&amp;#123;$age:=30&amp;#125;&amp;#125;</span><br><span class="line">    </span><br><span class="line">    &amp;#123;&amp;#123;if eq .Name $name&amp;#125;&amp;#125;</span><br><span class="line">        名字正确</span><br><span class="line">    &amp;#123;&amp;#123;else if eq .Age $age&amp;#125;&amp;#125;</span><br><span class="line">        年龄正确</span><br><span class="line">    &amp;#123;&amp;#123;else&amp;#125;&amp;#125;</span><br><span class="line">        全部错误</span><br><span class="line">    &amp;#123;&amp;#123;end&amp;#125;&amp;#125;</span><br><span class="line">&lt;/body&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"html/template"</span></span><br><span class="line">	<span class="string">"net/http"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> User <span class="keyword">struct</span> &#123;</span><br><span class="line">	Name <span class="keyword">string</span></span><br><span class="line">	Age  <span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">handler</span><span class="params">(res http. ResponseWriter, req *http. Request)</span></span> &#123;</span><br><span class="line">	t, _ := template.ParseFiles(<span class="string">"templates/index.html"</span>)</span><br><span class="line">	t.Execute(res, User&#123;Name: <span class="string">"杨大人"</span>, Age: <span class="number">20</span>&#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	server := http.Server&#123;Addr: <span class="string">"127.0.0.1:8080"</span>&#125;</span><br><span class="line">	http.Handle(<span class="string">"/static/"</span>, http.StripPrefix(<span class="string">"/static/"</span>, http.FileServer(http.Dir(<span class="string">"static"</span>))))</span><br><span class="line">	http.HandleFunc(<span class="string">"/"</span>, handler)</span><br><span class="line">	server.ListenAndServe()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="range-示例"><a href="#range-示例" class="headerlink" title="range 示例"></a>range 示例</h2><ul>
<li>数组</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    &amp;#123;&amp;#123;range .&amp;#125;&amp;#125;</span><br><span class="line">        &amp;#123;&amp;#123;.&amp;#125;&amp;#125; <span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">    &amp;#123;&amp;#123;end&amp;#125;&amp;#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"></span><br><span class="line">	<span class="string">"html/template"</span></span><br><span class="line">	<span class="string">"net/http"</span></span><br><span class="line"></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">handler</span><span class="params">(res http. ResponseWriter, req *http. Request)</span></span> &#123;</span><br><span class="line">	t, _ := template.ParseFiles(<span class="string">"templates/index.html"</span>)</span><br><span class="line">	pool := []<span class="keyword">string</span>&#123;<span class="string">"杨金恒"</span>, <span class="string">"洋大人"</span>, <span class="string">"杨大哥"</span>, <span class="string">"羊羊羊"</span>, <span class="string">"养牛的"</span>&#125;</span><br><span class="line">	t.Execute(res, pool)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	server := http.Server&#123;Addr: <span class="string">"127.0.0.1:8080"</span>&#125;</span><br><span class="line">	http.Handle(<span class="string">"/static/"</span>, http.StripPrefix(<span class="string">"/static/"</span>, http.FileServer(http.Dir(<span class="string">"static"</span>))))</span><br><span class="line">	http.HandleFunc(<span class="string">"/"</span>, handler)</span><br><span class="line">	server.ListenAndServe()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>map</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    &amp;#123;&amp;#123;range .&amp;#125;&amp;#125;</span><br><span class="line">        &amp;#123;&amp;#123;.&amp;#125;&amp;#125; <span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">    &amp;#123;&amp;#123;end&amp;#125;&amp;#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"html/template"</span></span><br><span class="line">	<span class="string">"net/http"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">handler</span><span class="params">(res http. ResponseWriter, req *http. Request)</span></span> &#123;</span><br><span class="line">	t, _ := template.ParseFiles(<span class="string">"templates/index.html"</span>)</span><br><span class="line">    mmp := <span class="keyword">map</span>[<span class="keyword">int</span>]<span class="keyword">string</span>&#123;<span class="number">1</span>: <span class="string">"杨金恒"</span>,<span class="number">2</span>: <span class="string">"阿茜"</span>, <span class="number">3</span>: <span class="string">"滕飞"</span>&#125;</span><br><span class="line">	t.Execute(res, mmp)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	server := http.Server&#123;Addr: <span class="string">"127.0.0.1:8080"</span>&#125;</span><br><span class="line">	http.Handle(<span class="string">"/static/"</span>, http.StripPrefix(<span class="string">"/static/"</span>, http.FileServer(http.Dir(<span class="string">"static"</span>))))</span><br><span class="line">	http.HandleFunc(<span class="string">"/"</span>, handler)</span><br><span class="line">	server.ListenAndServe()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="文件上传和下载"><a href="#文件上传和下载" class="headerlink" title="文件上传和下载"></a>文件上传和下载</h1><h2 id="文件上传"><a href="#文件上传" class="headerlink" title="文件上传"></a>文件上传</h2><table>
<thead>
<tr>
<th>头信息</th>
<th>作用</th>
</tr>
</thead>
<tbody>
<tr>
<td>exctype=”application/x-www-form-urlencoded”</td>
<td>默认值。表单会被编码为键=值&amp;</td>
</tr>
<tr>
<td>exctype=”multipart/form-data”</td>
<td>编码成消息，每个控件对应消息的一部分，请求方式必须是 POST，它可以上传文件和表单</td>
</tr>
<tr>
<td>exctype=”text/plain”</td>
<td>纯文本形式编码</td>
</tr>
</tbody>
</table>
<ul>
<li>HTML</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;form action=&quot;/upload&quot; method=&quot;POST&quot; enctype=&quot;multipart/form-data&quot;&gt;</span><br><span class="line">    名称：&lt;input type=&quot;text&quot; name=&quot;name&quot;&gt;&lt;br&gt;</span><br><span class="line">    文件：&lt;input type=&quot;file&quot; name=&quot;file&quot;&gt;&lt;br&gt;</span><br><span class="line">    &lt;input type=&quot;submit&quot; value=&quot;提交&quot;&gt;&lt;br&gt;</span><br><span class="line">    &lt;/form&gt;</span><br><span class="line">&lt;/body&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li>后端代码</li>
</ul>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"html/template"</span></span><br><span class="line">	<span class="string">"io/ioutil"</span></span><br><span class="line">	<span class="string">"net/http"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">upload</span><span class="params">(res http.ResponseWriter, req *http.Request)</span></span> &#123;</span><br><span class="line">	username := req.FormValue(<span class="string">"name"</span>)</span><br><span class="line">	file, header, _ := req.FormFile(<span class="string">"file"</span>)</span><br><span class="line">	b, _ := ioutil.ReadAll(file)</span><br><span class="line">	ioutil.WriteFile(<span class="string">"D:/"</span>+header.Filename, b, <span class="number">0777</span>)</span><br><span class="line">	res.Write([]<span class="keyword">byte</span>(username + <span class="string">"上传成功"</span>))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">handler</span><span class="params">(res http.ResponseWriter, req *http.Request)</span></span> &#123;</span><br><span class="line">	t, _ := template.ParseFiles(<span class="string">"templates/index.html"</span>)</span><br><span class="line">	t.Execute(res, <span class="literal">nil</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	server := http.Server&#123;Addr: <span class="string">"127.0.0.1:8080"</span>&#125;</span><br><span class="line">	http.Handle(<span class="string">"/static/"</span>, http.StripPrefix(<span class="string">"/static/"</span>, http.FileServer(http.Dir(<span class="string">"static"</span>))))</span><br><span class="line">	http.HandleFunc(<span class="string">"/"</span>, handler)</span><br><span class="line">	http.HandleFunc(<span class="string">"/upload"</span>, upload)</span><br><span class="line">	server.ListenAndServe()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="文件下载"><a href="#文件下载" class="headerlink" title="文件下载"></a>文件下载</h2><p>客户端下载文件时候，服务器需要设置的响应头信息：</p>
<ol>
<li>Content-Type: 内容的 MIME 类型</li>
</ol>
<p>application/octet-stream 任意类型</p>
<ol start="2">
<li>Content-Disposition: 客户端对内容的操作方式</li>
</ol>
<p>inline 默认值，表示浏览器能解析就解析，不能解析就下载</p>
<p>attachment;filename=下载时显示的文件名，客户端始终会下载文件</p>
<ul>
<li>html 代码</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/download?filename=abc.jpg"</span>&gt;</span>下载<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>后端代码</li>
</ul>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"html/template"</span></span><br><span class="line">	<span class="string">"io/ioutil"</span></span><br><span class="line">	<span class="string">"net/http"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">download</span><span class="params">(res http.ResponseWriter, req *http.Request)</span></span> &#123;</span><br><span class="line">	filename := req.FormValue(<span class="string">"filename"</span>)</span><br><span class="line">	f, err := ioutil.ReadFile(<span class="string">"D:/"</span> + filename)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		res.Write([]<span class="keyword">byte</span>(<span class="string">"下载失败"</span>))</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">    </span><br><span class="line">	res.Header().Set(<span class="string">"Content-Type"</span>, <span class="string">"application/octet-stream"</span>)</span><br><span class="line">	res.Header().Set(<span class="string">"Content-Disposition"</span>, <span class="string">"attachment;filename="</span>+filename)</span><br><span class="line">	res.Write(f)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">handler</span><span class="params">(res http.ResponseWriter, req *http.Request)</span></span> &#123;</span><br><span class="line">	t, _ := template.ParseFiles(<span class="string">"templates/index.html"</span>)</span><br><span class="line">	t.Execute(res, <span class="literal">nil</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	server := http.Server&#123;Addr: <span class="string">"127.0.0.1:8080"</span>&#125;</span><br><span class="line">	http.Handle(<span class="string">"/static/"</span>, http.StripPrefix(<span class="string">"/static/"</span>, http.FileServer(http.Dir(<span class="string">"static"</span>))))</span><br><span class="line">	http.HandleFunc(<span class="string">"/"</span>, handler)</span><br><span class="line">	http.HandleFunc(<span class="string">"/download"</span>, download)</span><br><span class="line">	server.ListenAndServe()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="JSON-和-AJAX"><a href="#JSON-和-AJAX" class="headerlink" title="JSON 和 AJAX"></a>JSON 和 AJAX</h1><p>在 GO 语言的标准库中 encoding/json 包下提供了 Marshal 和 Unmarshal 把结构体对象转换成 []byte 或者把 []byte 中信息写入到结构体对象中，在转换过程中 Go 提供了注解字段，可以来控制转换的过程。</p>
<ul>
<li>一些转换规则，**再次说明：json:”name” 中 : 和后面 name 之间没有空格</li>
</ul>
<table>
<thead>
<tr>
<th>注解</th>
<th>规则</th>
</tr>
</thead>
<tbody>
<tr>
<td>Field int `json:”-“`</td>
<td>字段将被忽略</td>
</tr>
<tr>
<td>Field int `json:”myname”`</td>
<td>字段在 JSON 中的键为 myname（常用）</td>
</tr>
<tr>
<td>Field int `json:”myname,omitempty”`</td>
<td>字段在 JSON 里的键为 myname 且如果字段为空值将在对象中省略掉</td>
</tr>
<tr>
<td>Field int `json:”,omitempty”`</td>
<td>字段在 JSON 里的键为 Field 如果字段为控制将在对象中省略</td>
</tr>
</tbody>
</table>
<ul>
<li>示例</li>
</ul>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"fullname"</span>: <span class="string">"yangjinheng"</span>,</span><br><span class="line">  	<span class="attr">"age"</span>: <span class="number">30</span>,</span><br><span class="line">    <span class="attr">"gender"</span>: <span class="string">"man"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> User <span class="keyword">struct</span> &#123;</span><br><span class="line">	Name <span class="keyword">string</span> <span class="string">`json:"fullname"`</span></span><br><span class="line">	Age  <span class="keyword">int</span>    <span class="string">`json:"age"`</span></span><br><span class="line">	Sex  <span class="keyword">string</span> <span class="string">`json:"gender"`</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2019/07/20/go/2.函数和结构体/" rel="next" title="函数结构体和面向对象和并发">
                <i class="fa fa-chevron-left"></i> 函数结构体和面向对象和并发
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  
    <div class="comments" id="comments">
      <div id="lv-container" data-id="city" data-uid="MTAyMC80MzE1My8xOTY5OQ=="></div>
    </div>

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/images/avatar.jpg" alt="Jin Heng">
            
              <p class="site-author-name" itemprop="name">Jin Heng</p>
              <p class="site-description motion-element" itemprop="description">越努力越幸运</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives">
              
                  <span class="site-state-item-count">72</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">6</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/yangjinheng" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="mailto:jinhengyang@foxmail.com" target="_blank" title="E-Mail">
                      
                        <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  </span>
                
            </div>
          

          
          

          
          

          
        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Socket"><span class="nav-number">1.</span> <span class="nav-text">Socket</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#回显服务器"><span class="nav-number">1.1.</span> <span class="nav-text">回显服务器</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#并发回显服务器"><span class="nav-number">1.2.</span> <span class="nav-text">并发回显服务器</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#点对点通信"><span class="nav-number">1.3.</span> <span class="nav-text">点对点通信</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#mysql"><span class="nav-number">2.</span> <span class="nav-text">mysql</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#安装驱动"><span class="nav-number">2.1.</span> <span class="nav-text">安装驱动</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#连接数据库"><span class="nav-number">2.2.</span> <span class="nav-text">连接数据库</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#插入数据"><span class="nav-number">2.3.</span> <span class="nav-text">插入数据</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#修改数据"><span class="nav-number">2.4.</span> <span class="nav-text">修改数据</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#删除数据"><span class="nav-number">2.5.</span> <span class="nav-text">删除数据</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#数据查询"><span class="nav-number">2.6.</span> <span class="nav-text">数据查询</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#XML"><span class="nav-number">3.</span> <span class="nav-text">XML</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#XML文档结构"><span class="nav-number">3.1.</span> <span class="nav-text">XML文档结构</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#XML-文件示例"><span class="nav-number">3.2.</span> <span class="nav-text">XML 文件示例</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#语法要求"><span class="nav-number">3.3.</span> <span class="nav-text">语法要求</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#特殊字符"><span class="nav-number">3.4.</span> <span class="nav-text">特殊字符</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#序列化规则"><span class="nav-number">3.5.</span> <span class="nav-text">序列化规则</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#XML-文件读取"><span class="nav-number">3.6.</span> <span class="nav-text">XML 文件读取</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#XML-文件生成"><span class="nav-number">3.7.</span> <span class="nav-text">XML 文件生成</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#logger"><span class="nav-number">4.</span> <span class="nav-text">logger</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#打印日志信息"><span class="nav-number">4.1.</span> <span class="nav-text">打印日志信息</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#打印日志到文件"><span class="nav-number">4.2.</span> <span class="nav-text">打印日志到文件</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#http-服务器"><span class="nav-number">5.</span> <span class="nav-text">http 服务器</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#单控制器"><span class="nav-number">5.1.</span> <span class="nav-text">单控制器</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#多控制器"><span class="nav-number">5.2.</span> <span class="nav-text">多控制器</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#使用多处理器"><span class="nav-number">5.2.1.</span> <span class="nav-text">使用多处理器</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#多处理器函数"><span class="nav-number">5.2.2.</span> <span class="nav-text">多处理器函数</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#获取请求头和参数"><span class="nav-number">5.3.</span> <span class="nav-text">获取请求头和参数</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#项目结构"><span class="nav-number">5.4.</span> <span class="nav-text">项目结构</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#html-模板"><span class="nav-number">5.5.</span> <span class="nav-text">html 模板</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#使用模板传递数据"><span class="nav-number">6.</span> <span class="nav-text">使用模板传递数据</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#模板语法"><span class="nav-number">6.1.</span> <span class="nav-text">模板语法</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#结构体示例"><span class="nav-number">6.2.</span> <span class="nav-text">结构体示例</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Map-类型示例"><span class="nav-number">6.3.</span> <span class="nav-text">Map 类型示例</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#方法类型示例"><span class="nav-number">6.4.</span> <span class="nav-text">方法类型示例</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#自定义函数类型"><span class="nav-number">6.5.</span> <span class="nav-text">自定义函数类型</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#if-条件示例"><span class="nav-number">6.6.</span> <span class="nav-text">if 条件示例</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#range-示例"><span class="nav-number">6.7.</span> <span class="nav-text">range 示例</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#文件上传和下载"><span class="nav-number">7.</span> <span class="nav-text">文件上传和下载</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#文件上传"><span class="nav-number">7.1.</span> <span class="nav-text">文件上传</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#文件下载"><span class="nav-number">7.2.</span> <span class="nav-text">文件下载</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#JSON-和-AJAX"><span class="nav-number">8.</span> <span class="nav-text">JSON 和 AJAX</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; 2017 &mdash; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Jin Heng</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  
    <script type="text/javascript">
      (function(d, s) {
        var j, e = d.getElementsByTagName(s)[0];
        if (typeof LivereTower === 'function') { return; }
        j = d.createElement(s);
        j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
        j.async = true;
        e.parentNode.insertBefore(j, e);
      })(document, 'script');
    </script>
  












  





  

  

  

  
  

  

  

  

</body>
</html>
